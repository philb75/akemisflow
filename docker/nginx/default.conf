server {
    listen 80;
    server_name localhost;
    
    # Allow CORS for development
    add_header 'Access-Control-Allow-Origin' 'http://localhost:3000' always;
    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type' always;
    
    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        return 204;
    }
    
    # Serve uploaded files
    location /uploads {
        alias /usr/share/nginx/html/uploads;
        autoindex off;
        
        # Set appropriate content types
        location ~ \.(pdf)$ {
            add_header Content-Type application/pdf;
        }
        location ~ \.(jpg|jpeg)$ {
            add_header Content-Type image/jpeg;
        }
        location ~ \.(png)$ {
            add_header Content-Type image/png;
        }
        location ~ \.(gif)$ {
            add_header Content-Type image/gif;
        }
        location ~ \.(doc|docx)$ {
            add_header Content-Type application/msword;
        }
        location ~ \.(xls|xlsx)$ {
            add_header Content-Type application/vnd.ms-excel;
        }
        location ~ \.(csv)$ {
            add_header Content-Type text/csv;
        }
        
        # Security headers
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;
        add_header X-XSS-Protection "1; mode=block";
    }
    
    # Health check endpoint
    location /health {
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }
}